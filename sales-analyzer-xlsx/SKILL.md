---
name: sales-analyzer-xlsx
description: 売上データCSVから高度な分析Excelを自動生成（リッチ版）。9シート構成でダッシュボード、ABC分析（パレート図）、担当者別分析、顧客ランク分析、クロス分析（ヒートマップ）、曜日分析、月次トレンド（移動平均・予測付き）、インタラクティブ分析を含む。条件付き書式、複合グラフ、カラースケール多用。「売上分析して」「ABC分析を作成」「パレート図を生成」「売上レポートを作って」「ダッシュボードを作成」などのリクエストで使用。
---

# Sales Analyzer XLSX（リッチ版）

売上データCSVから、プロフェッショナルな分析ダッシュボードExcelを自動生成する。

## 概要

入力された売上CSVデータを多角的に分析し、9シート構成の高機能Excelを生成:

1. **ダッシュボード** - KPI、目標達成率、グラフ、TOP5ランキング
2. **ABC分析** - パレート図、ランク別サマリー
3. **担当者別分析** - 売上ランキング、構成比
4. **顧客ランク分析** - A/B/Cランク別推移
5. **クロス分析** - カテゴリ×担当者ヒートマップ
6. **曜日分析** - 曜日パターン、インサイト
7. **月次トレンド** - 移動平均、来月予測
8. **インタラクティブ** - ドロップダウン連動フィルタ
9. **元データ** - フィルタ付き生データ

## 入力要件

CSVファイルに以下の列が必要:

| 列名例 | 必須 | 説明 |
|--------|------|------|
| 日付 | ○ | 取引日 |
| 売上金額 | ○ | 金額 |
| カテゴリ | ○ | 商品/サービス分類 |
| サービス名 | ○ | 個別商品/サービス名 |
| 担当者 | ○ | 担当営業 |
| 顧客ランク | △ | A/B/C等（オプション）|

## 出力Excel構成（9シート）

### シート1: ダッシュボード
```
┌─────────────────────────────────────────────────────────┐
│  📊 売上分析ダッシュボード           対象期間: XXXX     │
├─────────┬─────────┬─────────┬─────────────────────────────┤
│ 💰総売上 │ 📝件数  │ 💵平均  │ 📅稼働日数                  │
│ ¥131M   │ 500件   │ ¥263K  │ 245日                      │
├─────────┴─────────┴─────────┴─────────────────────────────┤
│ 🎯 目標達成率 ████████████████░░░░ 85%                   │
├─────────────────────────────────────────────────────────┤
│ 📈月別売上（移動平均線付き）│ 🏷️カテゴリ構成（円）        │
├─────────────────────────────────────────────────────────┤
│ 🏆TOP5ランキング │ 👥担当者別 │ ⭐顧客ランク別            │
└─────────────────────────────────────────────────────────┘
```

### シート2: ABC分析
- **ランク別サマリー**: A/B/C各ランクの件数・売上・構成比
- **詳細データ**: 順位、累積売上、累積構成比、ランク自動判定
- **パレート図**: 棒グラフ（売上）+ 折れ線（累積%）複合
- **条件付き書式**: ABCランク色分け（緑/黄/赤）、データバー

### シート3: 担当者別分析
- 売上ランキング（順位付き）
- 件数、平均単価、構成比
- データバー付き棒グラフ

### シート4: 顧客ランク分析
- A/B/Cランク別売上・件数・平均単価・標準偏差
- 月別×ランク別 積み上げ棒グラフ
- ランク色分け

### シート5: クロス分析（ヒートマップ）
- カテゴリ×担当者のマトリクス
- **カラースケール**: 濃い色ほど高売上
- 行・列合計

### シート6: 曜日分析
- 曜日別売上・件数・平均単価
- 土日色分け
- **自動インサイト**: 最高/最低曜日を検出

### シート7: 月次トレンド
- 前月比・前月差額
- **3ヶ月移動平均線**（複合グラフ）
- **来月予測**（トレンドベース簡易予測）
- 前月比の条件付き書式（プラス緑/マイナス赤）

### シート8: インタラクティブ
- ドロップダウン選択（カテゴリ、担当者、期間）
- 選択に応じた集計結果表示

### シート9: 元データ
- 加工前の生データ
- オートフィルタ有効

## 技術仕様

### 使用ライブラリ
```python
from openpyxl import Workbook
from openpyxl.chart import BarChart, LineChart, PieChart, AreaChart, Reference
from openpyxl.chart.label import DataLabelList
from openpyxl.chart.marker import Marker
from openpyxl.styles import Font, PatternFill, Border, Side, Alignment
from openpyxl.formatting.rule import ColorScaleRule, DataBarRule, FormulaRule
from openpyxl.worksheet.datavalidation import DataValidation
import pandas as pd
```

### カラーパレット
```python
COLORS = {
    'primary': '2E5090',      # ダークブルー
    'secondary': '4A90E2',    # ライトブルー
    'accent': '7CB342',       # グリーン
    'warning': 'FFA726',      # オレンジ
    'danger': 'EF5350',       # レッド
}
```

### 条件付き書式
- ABCランク色分け: A=緑, B=黄, C=赤
- 売上金額: データバー
- 前月比: プラス=緑, マイナス=赤
- ヒートマップ: カラースケール（白→青）

### グラフ仕様
- パレート図: 棒グラフ + 折れ線（複合、2軸）
- 月次トレンド: 棒グラフ + 移動平均線
- カテゴリ構成: 円グラフ（%ラベル付き）
- 顧客ランク推移: 積み上げ棒グラフ

## コード実装

### リッチ版（推奨）
```bash
python scripts/generate_sales_analysis_rich.py \
  --input sales_data.csv \
  --output sales_analysis.xlsx \
  --date-col 日付 \
  --amount-col 売上金額 \
  --category-col カテゴリ \
  --item-col サービス名 \
  --staff-col 担当者 \
  --rank-col 顧客ランク
```

### シンプル版
```bash
python scripts/generate_sales_analysis.py \
  --input sales_data.csv \
  --output sales_analysis.xlsx \
  --date-col 日付 \
  --amount-col 売上金額 \
  --category-col カテゴリ \
  --item-col サービス名 \
  --staff-col 担当者
```

## セミナーデモ向け演出

### 見せどころ（5つ）

1. **ダッシュボード**
   - 「1画面で経営状況が把握できます」
   - 目標達成率のプログレスバー

2. **パレート図**
   - 「80:20の法則が一目でわかります」
   - 「上位20%の商品が売上の80%を占めています」

3. **ヒートマップ**
   - 「誰がどのカテゴリで強いか、色の濃さでわかります」
   - 「田中さんはシステム開発が得意ですね」

4. **曜日分析**
   - 「水曜が最も売上が高いというインサイトが自動で出ています」

5. **来月予測**
   - 「過去のトレンドから来月の売上を予測しています」

### トーク例
「この500行の売上データから、9シート構成の経営ダッシュボードが完成しました。

まずダッシュボード。総売上1.3億円、目標達成率85%が一目でわかります。

ABC分析を見てください。パレート図で、上位20%のサービスが売上の80%を占めていることがわかります。

このヒートマップ、色が濃いほど売上が高い。田中さんはシステム開発、佐藤さんはマーケティングが得意だとわかります。

曜日分析では、水曜日が最も売上が高いというインサイトが自動で出ています。

最後に月次トレンド。移動平均線と、来月の予測も出ています。

この分析、従来なら半日かかる作業が、1分で完了しました。」

## 制約

### DO
- すべてのグラフはデータ連動（動的更新可能）
- 条件付き書式で視覚的にわかりやすく
- recalc.py実行で数式を確定

### DO NOT
- Python側で集計してハードコード（グラフ用データは例外）
- 静的な画像グラフ
- 複雑すぎて壊れやすい数式

## 関連スキル

- **data-cleaner**: 前処理として連携可能
- **smart-chart-generator**: PNG画像出力が必要な場合
